---
title: "PRoteinMassSpecSim"
author: "Sebastian Malchow"
date: "4 Februar 2017"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Goals

Aim of this project is to simulate Protein Mass Spectra from the Protein Sequence. This includes simulation of the isotope pattern, the pattern generated by several charge states which are usually observed. In a later stage the resolution of the mass spectrometer shall be included to have an idea of the influence of the resolution to the observed isotopic pattern.

Further features might be the simulation of a mass spectrum by UniProt Accession instead of Protein Sequence, which is possible by looking up the sequence from UniProt, and the generation of a comparision plot to a measured spectrum for protein identification and publication purposes.

## ToDo

* Add code to calculate chemical formula from protein sequence, allow addition of common modfications
* Utilize isotope distribution simulation from http://orgmassspec.github.io/
* Add spectra generation
* Add resolution simulation for orbitrap mass spectrometers
* Add spectra import of as a list of mass and intensity
* Plot head to tails comparision plot with ggplot


## Code


```{r}

#source("https://bioconductor.org/biocLite.R")
#biocLite("UniProt.ws")
library(UniProt.ws)

library("OrgMassSpecR")
library("ggplot2")

source("Functions.R")

```


```{r}

up <- UniProt.ws(taxId=9606)

up

keytypes(up)

columns(up)

proteinAccession <- "P41236"

proteinSequence <- select(up, proteinAccession, "SEQUENCE", "UNIPROTKB")[,2]

proteinChemForm <- pepToForm(proteinSequence, output = "list")

MonoisotopicMass(proteinChemForm)

isotopeDist <- IsotopicDistribution(proteinChemForm)

ggplot(isotopeDist, aes(mz, percent)) + geom_point()
ggplot(isotopeDist, aes(mz, ymin = 0, ymax = percent)) + geom_linerange()

charges <- 45

Hydrogen = 1.0078250321

remove(isotopeDist_ch)



for (z in charges){
  
  tmp <- isotopeDist
  tmp$z <- z
  tmp$mz <- ( tmp$mz + (Hydrogen * z))  / z
  
  if ( z == charges[1]){isotopeDist_ch <- tmp}
  else {isotopeDist_ch <- rbind(isotopeDist_ch, tmp)}
  
}

ggplot(isotopeDist_ch, aes(mz, ymin = 0, ymax = percent, colour = "red")) + geom_linerange()


C9H8O4

aspirin <- IsotopicDistribution( list(C = 9, H = 8, O = 4))
ggplot(aspirin, aes(mz, ymin = 0, ymax = percent, colour = "red")) + geom_linerange()

```



<!-- ## Usage Example -->

<!-- You can also embed plots, for example: -->

<!-- ```{r pressure, echo=FALSE} -->
<!-- plot(pressure) -->
<!-- ``` -->

<!-- Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot. -->

