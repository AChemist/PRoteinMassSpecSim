
# +++Goals+++

#Aim of this project is to simulate Protein Mass Spectra from the Protein Sequence. This includes simulation of the isotope pattern, the pattern generated by several charge states which are usually observed. In a later stage the resolution of the mass spectrometer shall be included to have an idea of the influence of the resolution to the observed isotopic pattern.

#Further features might be the simulation of a mass spectrum by UniProt Accession instead of Protein Sequence, which is possible by looking up the sequence from UniProt, and the generation of a comparision plot to a measured spectrum for protein identification and publication purposes.

# +++ToDo+++

#* Add code to calculate chemical formula from protein sequence, allow addition of common modfications
#* Utilize isotope distribution simulation from http://orgmassspec.github.io/
#* Add spectra generation
#* Add resolution simulation for orbitrap mass spectrometers
#* Add spectra import of as a list of mass and intensity
#* Plot head to tails comparision plot with ggplot


# +++Code+++

#source("https://bioconductor.org/biocLite.R")
#biocLite("UniProt.ws")
library(UniProt.ws)

library("OrgMassSpecR")
library("ggplot2")
library("plyr")

source("Functions.R")


up <- UniProt.ws(9796)

proteinAccession <- "P68082"

proteinSequence <- select(up, proteinAccession, "SEQUENCE", "UNIPROTKB")[,2]

proteinChemForm <- pepToForm(proteinSequence, output = "list")

MonoisotopicMass(proteinChemForm)

isotopeDist <- IsotopicDistribution(proteinChemForm, charge = 20)

ggplot(isotopeDist, aes(mz, percent)) + geom_point()
ggplot(isotopeDist, aes(mz, ymin = 0, ymax = percent)) + geom_linerange()

 
aspirin <- IsotopicDistribution( list(C = 9, H = 8, O = 4))
ggplot(aspirin, aes(mz, ymin = 0, ymax = percent, colour = "red")) + geom_linerange()



myo <- read.csv2("Spectrum_Myoglobin.csv", sep = ",", dec = "." )
colnames(myo) <- c("mz", "intensity")

p <- ggplot()
p <- p + geom_line(data =  myo, aes(mz, intensity)) 
p + xlim(c(807.5,812))

myo_sim <- generateChargedDist(uniprotSpeciesName = "Equus caballus", proteinAccession = "P68082", charge = 25:10, removeFirstM = TRUE, modification = "C 0 H 0 N 0 O 0 S 0 P 0")

fit <- myo[ round(myo$mz, digits = 2) %in% round(myo_sim$mz[ myo_sim$percent == 100 ], digits = 2),]
fit <- fit[ fit$intensity == max(fit$intensity),]

myo_sim$fittedIntensity <- NA
myo_sim$fittedIntensity <- fit$intensity * myo_sim$percent / 100  

p <- p + geom_linerange(data = myo_sim, aes(mz, ymin = 0, ymax = fittedIntensity, colour = "red"))
p <- p + geom_line(data = myo_sim, aes(mz, fittedIntensity, colour = "red"))
p + xlim(c(807.5,812))

myo_sim <- generateChargedDist(uniprotSpeciesName = "Equus caballus", proteinAccession = "P68082", charge = 25:10, removeFirstM = TRUE, modification = "C 0 H 0 N 0 O 1 S 0 P 0")

fit <- myo[ round(myo$mz, digits = 2) %in% round(myo_sim$mz[ myo_sim$percent == 100 ], digits = 2),]
fit <- fit[ fit$intensity == max(fit$intensity),]

myo_sim$fittedIntensity <- NA
myo_sim$fittedIntensity <- fit$intensity * myo_sim$percent / 100  

p <- p + geom_linerange(data = myo_sim, aes(mz, ymin = 0, ymax = fittedIntensity, colour = "red"))
p <- p + geom_line(data = myo_sim, aes(mz, fittedIntensity, colour = "red"))
p + xlim(c(807.5,812))

myo_sim <- generateChargedDist(uniprotSpeciesName = "Equus caballus", proteinAccession = "P68082", charge = 25:10, removeFirstM = TRUE, modification = "C 0 H 0 N 0 O 2 S 0 P 0")

fit <- myo[ round(myo$mz, digits = 2) %in% round(myo_sim$mz[ myo_sim$percent == 100 ], digits = 2),]
fit <- fit[ fit$intensity == max(fit$intensity),]

myo_sim$fittedIntensity <- NA
myo_sim$fittedIntensity <- fit$intensity * myo_sim$percent / 100  

p <- p + geom_linerange(data = myo_sim, aes(mz, ymin = 0, ymax = fittedIntensity, colour = "red"))
p <- p + geom_line(data = myo_sim, aes(mz, fittedIntensity, colour = "red"))
p + xlim(c(807.5,812))

myo_sim <- generateChargedDist(uniprotSpeciesName = "Equus caballus", proteinAccession = "P68082", charge = 25:10, removeFirstM = TRUE, modification = "C 0 H 0 N 0 O 2 S 0 P 1")

fit <- myo[ round(myo$mz, digits = 2) %in% round(myo_sim$mz[ myo_sim$percent == 100 ], digits = 2),]
fit <- fit[ fit$intensity == max(fit$intensity),]

myo_sim$fittedIntensity <- NA
myo_sim$fittedIntensity <- fit$intensity * myo_sim$percent / 100  

p <- p + geom_linerange(data = myo_sim, aes(mz, ymin = 0, ymax = fittedIntensity, colour = "red"))
p <- p + geom_line(data = myo_sim, aes(mz, fittedIntensity, colour = "red"))
p + xlim(c(807.5,812))

p <- p + xlim(c(807.5,812))
ggsave(filename = "DemoPlot.png", plot = p)
